---
title: Upgrade to 2.3
order: 30
---

These notes cover an upgrade from 2.2 to 2.3.

## Use new formats config for actions

`Hanami::Action.format`, `Hanami::Action::Config#format`, `Hanami::Action::Config::Formats#values`, and `Hanami::Action::Config::Formats#add` are now deprecated and will be removed in Hanami 2.4.

These methods are deprecated because they did not make it clear that configuring a format would immediately restrict requests based on that format, and conflated the registration of custom MIME types with immediately restricting based on those types, and did not allow for the default response format to be independently configured. This led to unexpected behaviors and made it difficult configure formats in the app or base action classes.

The new format config API is documented in [Formats and MIME types](/v2.3/actions/formats-and-mime-types). To use it, make the following changes wherever you configure your actions (in your app class using `config.actions`, or directly in your action classes using `config` or `format`).

Change `format` and `config.format` to `config.formats.accept`. For example:

```ruby
# In app or slice classes:
#
# Before:
#   config.actions.format :json
config.actions.formats.accept :json

# In an action class:
#
# Before:
#   format :json
# Or:
#   config.format :json
config.formats.accept :json
```

Change `config.formats.add` to `config.formats.register`. For example:

```ruby
# In app or slice classes:
#
# Before:
#   config.actions.formats.add :custom, "application/custom"
config.actions.formats.register custom: "application/custom"

# In an action class:
#
# Before:
#   config.formats.add :custom, "application/custom"
config.formats.register custom: "application/custom"
```

With these changes, calling `register` no longer adds the format to the list of accepted formats. You must now do this separately:

```ruby
config.formats.register custom: "application/custom"
config.formats.accept :custom
```

The benefit of this change is that you can now more easily `register` custom MIME types in an app class or base action class, and then choose to `accept` them only in specific action classes.
